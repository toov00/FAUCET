<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MTK Token Faucet</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #f8f6f3;
      --bg-warm: #f3f0eb;
      --card-bg: rgba(255, 255, 255, 0.7);
      --card-border: rgba(255, 255, 255, 0.9);
      --accent: #e07a5f;
      --accent-soft: rgba(224, 122, 95, 0.12);
      --accent-glow: rgba(224, 122, 95, 0.25);
      --text: #2d2a26;
      --text-soft: #7a756e;
      --text-muted: #a8a29e;
      --success: #81b29a;
      --success-soft: rgba(129, 178, 154, 0.15);
      --warning: #f2cc8f;
      --warning-soft: rgba(242, 204, 143, 0.2);
      --error: #c97064;
      --error-soft: rgba(201, 112, 100, 0.12);
      --shadow: 0 4px 24px rgba(45, 42, 38, 0.06);
      --shadow-lg: 0 12px 48px rgba(45, 42, 38, 0.1);
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      position: relative;
      overflow-x: hidden;
    }

    /* Background decoration */
    body::before {
      content: '';
      position: fixed;
      top: -20%;
      right: -10%;
      width: 50vw;
      height: 50vw;
      background: radial-gradient(circle, var(--accent-soft) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    body::after {
      content: '';
      position: fixed;
      bottom: -10%;
      left: -10%;
      width: 40vw;
      height: 40vw;
      background: radial-gradient(circle, rgba(129, 178, 154, 0.08) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      max-width: 420px;
      width: 100%;
      position: relative;
      z-index: 1;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 2.5rem;
      animation: fadeDown 0.8s ease-out;
    }

    @keyframes fadeDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .logo {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.7rem;
      font-weight: 500;
      color: var(--accent);
      letter-spacing: 0.25em;
      text-transform: uppercase;
      margin-bottom: 1rem;
    }

    .title {
      font-family: 'Instrument Serif', serif;
      font-size: 3rem;
      font-weight: 400;
      line-height: 1.1;
      margin-bottom: 0.75rem;
      color: var(--text);
    }

    .title span {
      font-style: italic;
      color: var(--accent);
    }

    .subtitle {
      color: var(--text-soft);
      font-size: 0.95rem;
      font-weight: 400;
    }

    /* Card */
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 24px;
      padding: 2rem;
      box-shadow: var(--shadow);
      animation: fadeUp 0.8s ease-out 0.1s both;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Connect Section */
    .connect-section {
      text-align: center;
      padding: 1rem 0;
    }

    .wallet-illustration {
      width: 80px;
      height: 80px;
      margin: 0 auto 1.5rem;
      position: relative;
    }

    .wallet-circle {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--accent-soft) 0%, transparent 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse 3s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .wallet-circle svg {
      width: 36px;
      height: 36px;
      stroke: var(--accent);
      stroke-width: 1.5;
    }

    .connect-text {
      color: var(--text-soft);
      font-size: 0.9rem;
      margin-bottom: 1.75rem;
      line-height: 1.5;
    }

    /* Buttons */
    .btn {
      font-family: 'DM Sans', sans-serif;
      font-weight: 500;
      font-size: 0.9rem;
      padding: 1rem 2rem;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
      box-shadow: 0 4px 16px var(--accent-glow);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 28px var(--accent-glow);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-soft);
      border: 1px solid rgba(0, 0, 0, 0.08);
    }

    .btn-ghost:hover {
      background: rgba(0, 0, 0, 0.02);
      border-color: rgba(0, 0, 0, 0.12);
      color: var(--text);
    }

    /* Connected Header */
    .connected-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 1.5rem;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .address {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 0.8rem;
      color: var(--text);
      background: var(--bg-warm);
      padding: 0.5rem 0.875rem;
      border-radius: 10px;
    }

    .network-badge {
      font-size: 0.7rem;
      font-weight: 500;
      color: var(--success);
      background: var(--success-soft);
      padding: 0.4rem 0.75rem;
      border-radius: 8px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Stats */
    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stat {
      background: var(--bg-warm);
      border-radius: 16px;
      padding: 1.25rem;
      text-align: center;
    }

    .stat-label {
      font-size: 0.7rem;
      font-weight: 500;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 1.25rem;
      font-weight: 500;
      color: var(--text);
    }

    .stat-value.highlight {
      color: var(--accent);
    }

    /* Status Messages */
    .status {
      text-align: center;
      padding: 0.875rem 1rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .status.info {
      background: var(--bg-warm);
      color: var(--text-soft);
    }

    .status.success {
      background: var(--success-soft);
      color: #5a8a72;
    }

    .status.error {
      background: var(--error-soft);
      color: var(--error);
    }

    .status.warning {
      background: var(--warning-soft);
      color: #b8963d;
    }

    /* Cooldown */
    .cooldown-section {
      text-align: center;
      padding: 1rem 0;
    }

    .cooldown-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .cooldown-timer {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 2.25rem;
      font-weight: 500;
      color: var(--text);
      letter-spacing: 0.05em;
    }

    /* Footer */
    .footer {
      text-align: center;
      margin-top: 2rem;
      animation: fadeUp 0.8s ease-out 0.2s both;
    }

    .footer a {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .footer a:hover {
      color: var(--accent);
    }

    /* Utilities */
    .hidden {
      display: none !important;
    }

    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 480px) {
      body {
        padding: 1.25rem;
        justify-content: flex-start;
        padding-top: 3rem;
      }
      
      .card {
        padding: 1.5rem;
        border-radius: 20px;
      }
      
      .title {
        font-size: 2.5rem;
      }
      
      .stats {
        gap: 0.75rem;
      }

      .stat {
        padding: 1rem;
      }

      .stat-value {
        font-size: 1.1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">Faucet</div>
    </header>

    <!-- Connect Card -->
    <div id="connect-card" class="card connect-section">
      <div class="wallet-illustration">
        <div class="wallet-circle">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 11-6 0H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V9M3 12V9m18 0a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 9m18 0V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v3" />
          </svg>
        </div>
      </div>
      <button id="connect-btn" class="btn btn-primary">CLAIM TOKENS</button>
      <div id="connect-error" class="status error hidden" style="margin-top: 1rem;"></div>
    </div>

    <!-- Main Card -->
    <div id="main-card" class="card hidden">
      <div class="connected-header">
        <span id="user-address" class="address">0x...</span>
        <span id="network-badge" class="network-badge">Sepolia</span>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="stat-label">Your Balance</div>
          <div id="user-balance" class="stat-value highlight">0 MTK</div>
        </div>
        <div class="stat">
          <div class="stat-label">Faucet</div>
          <div id="faucet-balance" class="stat-value">0 MTK</div>
        </div>
      </div>

      <div id="status-area"></div>

      <div id="cooldown-section" class="cooldown-section hidden">
        <p class="cooldown-label">Next claim available in</p>
        <div id="cooldown-timer" class="cooldown-timer">00:00:00</div>
      </div>

      <button id="claim-btn" class="btn btn-primary">Claim 100 MTK</button>
      <button id="disconnect-btn" class="btn btn-ghost" style="margin-top: 0.75rem;">Disconnect</button>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <a href="https://sepolia.etherscan.io" target="_blank" rel="noopener">View on Etherscan ↗</a>
    </footer>
  </div>

  <!-- Ethers.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.9.0/ethers.umd.min.js"></script>
  
  <script>
    // ============================================
    // ⚠️  UPDATE THESE WITH YOUR DEPLOYED ADDRESSES
    // ============================================
    const TOKEN_ADDRESS = "";
    const FAUCET_ADDRESS = "";
    
    const EXPECTED_CHAIN_ID = 11155111;
    const CHAIN_NAME = "Sepolia";

    const TOKEN_ABI = [
      "function balanceOf(address account) view returns (uint256)",
      "function symbol() view returns (string)",
      "function decimals() view returns (uint8)"
    ];

    const FAUCET_ABI = [
      "function claim() external",
      "function canClaim(address user) view returns (bool)",
      "function timeUntilNextClaim(address user) view returns (uint256)",
      "function claimAmount() view returns (uint256)",
      "function faucetBalance() external view returns (uint256)",
      "event TokensClaimed(address indexed user, uint256 amount)"
    ];

    let provider = null;
    let signer = null;
    let userAddress = null;
    let tokenContract = null;
    let faucetContract = null;
    let cooldownInterval = null;

    const connectCard = document.getElementById('connect-card');
    const mainCard = document.getElementById('main-card');
    const connectBtn = document.getElementById('connect-btn');
    const claimBtn = document.getElementById('claim-btn');
    const disconnectBtn = document.getElementById('disconnect-btn');
    const connectError = document.getElementById('connect-error');
    const userAddressEl = document.getElementById('user-address');
    const networkBadge = document.getElementById('network-badge');
    const userBalanceEl = document.getElementById('user-balance');
    const faucetBalanceEl = document.getElementById('faucet-balance');
    const statusArea = document.getElementById('status-area');
    const cooldownSection = document.getElementById('cooldown-section');
    const cooldownTimer = document.getElementById('cooldown-timer');

    function formatAddress(address) {
      return `${address.slice(0, 6)}...${address.slice(-4)}`;
    }

    function formatTokens(wei, decimals = 18) {
      const value = Number(ethers.formatUnits(wei, decimals));
      return value.toLocaleString(undefined, { maximumFractionDigits: 2 });
    }

    function formatTime(seconds) {
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      const s = seconds % 60;
      return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function showStatus(message, type = 'info') {
      statusArea.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    function clearStatus() {
      statusArea.innerHTML = '';
    }

    async function connectWallet() {
      try {
        connectBtn.disabled = true;
        connectBtn.innerHTML = '<span class="spinner"></span>Connecting...';
        connectError.classList.add('hidden');

        if (!window.ethereum) {
          throw new Error('Please install MetaMask to use this dApp');
        }

        const accounts = await window.ethereum.request({
          method: 'eth_requestAccounts'
        });

        if (accounts.length === 0) {
          throw new Error('No accounts found. Please unlock MetaMask.');
        }

        provider = new ethers.BrowserProvider(window.ethereum);
        signer = await provider.getSigner();
        userAddress = await signer.getAddress();

        const network = await provider.getNetwork();
        if (Number(network.chainId) !== EXPECTED_CHAIN_ID) {
          throw new Error(`Please switch to ${CHAIN_NAME} network`);
        }

        tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, provider);
        faucetContract = new ethers.Contract(FAUCET_ADDRESS, FAUCET_ABI, signer);

        connectCard.classList.add('hidden');
        mainCard.classList.remove('hidden');
        userAddressEl.textContent = formatAddress(userAddress);
        networkBadge.textContent = CHAIN_NAME;

        await refreshData();

        window.ethereum.on('accountsChanged', handleAccountsChanged);
        window.ethereum.on('chainChanged', () => window.location.reload());

      } catch (error) {
        console.error('Connection error:', error);
        connectError.textContent = error.message;
        connectError.classList.remove('hidden');
        connectBtn.disabled = false;
        connectBtn.innerHTML = 'Connect Wallet';
      }
    }

    function handleAccountsChanged(accounts) {
      if (accounts.length === 0) {
        disconnect();
      } else {
        window.location.reload();
      }
    }

    function disconnect() {
      provider = null;
      signer = null;
      userAddress = null;
      tokenContract = null;
      faucetContract = null;
      
      if (cooldownInterval) {
        clearInterval(cooldownInterval);
        cooldownInterval = null;
      }

      mainCard.classList.add('hidden');
      connectCard.classList.remove('hidden');
      connectBtn.disabled = false;
      connectBtn.innerHTML = 'Connect Wallet';
      clearStatus();
    }

    async function refreshData() {
      try {
        const [userBalance, faucetBalance] = await Promise.all([
          tokenContract.balanceOf(userAddress),
          faucetContract.faucetBalance()
        ]);

        userBalanceEl.textContent = `${formatTokens(userBalance)} MTK`;
        faucetBalanceEl.textContent = `${formatTokens(faucetBalance)} MTK`;

        await updateClaimStatus();

      } catch (error) {
        console.error('Error refreshing data:', error);
        showStatus('Error loading data. Check console for details.', 'error');
      }
    }

    async function updateClaimStatus() {
      try {
        const canClaim = await faucetContract.canClaim(userAddress);
        
        if (canClaim) {
          claimBtn.disabled = false;
          claimBtn.textContent = 'Claim 100 MTK';
          cooldownSection.classList.add('hidden');
          
          if (cooldownInterval) {
            clearInterval(cooldownInterval);
            cooldownInterval = null;
          }
        } else {
          claimBtn.disabled = true;
          claimBtn.textContent = 'Cooldown Active';
          cooldownSection.classList.remove('hidden');
          startCooldownTimer();
        }
      } catch (error) {
        console.error('Error checking claim status:', error);
      }
    }

    async function startCooldownTimer() {
      if (cooldownInterval) {
        clearInterval(cooldownInterval);
      }

      const updateTimer = async () => {
        try {
          const timeLeft = await faucetContract.timeUntilNextClaim(userAddress);
          const seconds = Number(timeLeft);
          
          if (seconds <= 0) {
            clearInterval(cooldownInterval);
            cooldownInterval = null;
            await updateClaimStatus();
            return;
          }
          
          cooldownTimer.textContent = formatTime(seconds);
        } catch (error) {
          console.error('Error updating timer:', error);
        }
      };

      await updateTimer();
      cooldownInterval = setInterval(updateTimer, 1000);
    }

    async function claimTokens() {
      try {
        claimBtn.disabled = true;
        claimBtn.innerHTML = '<span class="spinner"></span>Claiming...';
        clearStatus();

        const tx = await faucetContract.claim();
        showStatus('Transaction submitted. Waiting for confirmation...', 'info');

        const receipt = await tx.wait();
        
        if (receipt.status === 1) {
          showStatus('Successfully claimed 100 MTK!', 'success');
        } else {
          throw new Error('Transaction failed');
        }

        await refreshData();

      } catch (error) {
        console.error('Claim error:', error);
        
        let errorMessage = 'Failed to claim tokens.';
        
        if (error.message.includes('user rejected')) {
          errorMessage = 'Transaction cancelled.';
        } else if (error.message.includes('Please wait')) {
          errorMessage = 'Please wait for cooldown to finish.';
        } else if (error.message.includes('Faucet is empty')) {
          errorMessage = 'Faucet is empty! No tokens left to claim.';
        }
        
        showStatus(errorMessage, 'error');
        await updateClaimStatus();
      }
    }

    connectBtn.addEventListener('click', connectWallet);
    claimBtn.addEventListener('click', claimTokens);
    disconnectBtn.addEventListener('click', disconnect);

    window.addEventListener('load', async () => {
      if (window.ethereum) {
        const accounts = await window.ethereum.request({ method: 'eth_accounts' });
        if (accounts.length > 0) {
          connectWallet();
        }
      }
    });
  </script>
</body>
</html>
